{
	"name": "single-site-based-policy-set",
	"policies": [
		{
			"name": "Operators can read a site if they are assigned to the site.",
			"target": {
				"name": "When a operator reads a site",
				"resource": {
					"name": "Site",
					"uriTemplate": "/secured-by-value/sites/{site_id}"
				},
				"action": "GET",
				"subject": {
					"name": ""
				}
			},
			"conditions": [
				{
					"name": "",
					"condition": "match.single(subject.attributes('https://acs.attributes.int', 'site'), resource.uriVariable('site_id'))"
				}
			],
			"obligationIds": [
				"obligation1",
				"obligation2"
			],
			"effect": "PERMIT"
		}
	],
	"obligations": [
		{
			"id": null,
			"type": "CUSTOM",
			"actionTemplate": {
				"sqlStatement": "SELECT firstName, lastName, RIGHT(ssn, 4), LEFT(address, 11) FROM employee_records LIMIT 100 where site = '$1' AND id='$2'"
			},
			"actionArguments": [
				{
					"name": "resource site",
					"value": "resource.uriVariable('site_id')"
				},
				{
					"name": "record id",
					"value": "resource.uriVariable('record_id')"
				}
			]
		},
		{
			"id": "",
			"type": "CUSTOM",
			"actionTemplate": {
				"filter": "where site = $1",
				"select": [
					{
						"name": "firstName"
					},
					{
						"name": "lastName"
					},
					{
						"name": "address",
						"lenStart": "0",
						"len": "11"
					},
					{
						"name": "ssn",
						"lenStart": "5",
						"len": "4"
					},
					{
						"name": "salary",
						"encrypt": "sha-256"
					}
				]
			},
			"actionArguments": [
				{
					"name": "subject site",
					"value": "subject.attributes('https://acs.attributes.int', 'site')"
				}
			]
		}
	]
}